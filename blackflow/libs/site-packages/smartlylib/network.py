'''
Created on Sep 28, 2013

@author: johnny
'''
import commands


def getDefaultGwInterface():
    '''
    Returns the current default Gateway network interface name
    '''
    routeTable = commands.getoutput('ip route show').split("\n")
    ifName = None
    for rtLine in routeTable:
        rtLineFields = rtLine.strip().split()
        if (rtLineFields[0] == 'default'):
            return rtLineFields[4]
    
    return None
    

def getActiveLocalIp():
    '''
    Returns the currently active IP address
    '''
    ifName = getDefaultGwInterface()
    if ifName == None: return None
    
    ifInfoLines = commands.getoutput('ip address show '+ifName).split("\n")
    for ifLine in ifInfoLines:
        ifLineFields = ifLine.split()
        if (ifLineFields[0] == 'inet'):
            ipParts = ifLineFields[1].split('/')
            return ipParts[0]
        
    return None
    


def getMacAddress(ifName):
    '''
    Retrieves the mac address from the speficied network interface
    '''
    try:
        with open('/sys/class/net/'+ifName+'/address', 'r') as fileDesc:
            return fileDesc.read().strip()
    except IOError:
        raise ValueError("The specified network interface does not exist")
        